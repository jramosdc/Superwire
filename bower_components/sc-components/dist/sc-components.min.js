/**
 * sc-components
 * Simple reusable angular UI components
 * @version 0.1.38
 * Copyright(c) SafetyChanger
 * @license MIT
 */

"use strict";angular.module("sc-components",["sc-confirm","sc-dropdown","sc-enter","sc-list","sc-listing"]),angular.module("sc-confirm",["ui.bootstrap"]).constant("scConfirmDefaults",{message:"Are you sure?",btnPlacement:"right"}).directive("scConfirm",["$modal","$compile","$parse","$http","$q","$templateCache","scConfirmDefaults",function($modal,$compile,$parse,$http,$q,$templateCache,defaults){return{restrict:"A",link:function($scope,element,attrs){function onConfirm(){$parse(attrs.scConfirm)($scope)}function onCancel(){$parse(attrs.scOnCancel)($scope)}var btnPlacement,template,templateUrl,scope=$scope.$new(),isDefined=angular.isDefined,deferred=$q.defer(),promise=deferred.promise,validPlacements=["left","center","right"];$scope.$on("$destroy",function(){scope.$destroy()}),isDefined(attrs.template)?(template=scope.$parent.$eval(attrs.template),deferred.resolve(template)):isDefined(attrs.templateUrl)?(templateUrl=scope.$parent.$eval(attrs.templateUrl),$http.get(templateUrl,{cache:$templateCache}).success(function(html){deferred.resolve(html)}).error(deferred.reject)):deferred.resolve(""),isDefined(attrs.btnPlacement)&&(btnPlacement=scope.$parent.$eval(attrs.btnPlacement)),scope.message=attrs.scConfirmMessage||defaults.message,attrs.$observe("scConfirmMessage",function(msg){scope.message=msg||defaults.message}),~validPlacements.indexOf(btnPlacement)||(btnPlacement=defaults.btnPlacement),promise.then(function(tpl){var template=['<div class="modal-header">','  <button type="button" class="close" ng-click="cancel()" aria-hidden="true">&times;</button>','  <h4 class="modal-title">{{ message }}</h4>',"</div>",'<div class="modal-body">',"  "+tpl+"&nbsp;","</div>",'<div class="modal-footer sc-'+btnPlacement+'">','  <button class="btn btn-primary" ng-click="ok()">Yes</button>','  <button class="btn btn-link" ng-click="cancel()">Cancel</button>',"</div>"].join("\n");element.bind("click",function(){var modalInstance=$modal.open({template:template,controller:"ModalInstanceCtrl",scope:scope,resolve:{onCancel:function(){return onCancel}}});modalInstance.result.then(onConfirm)})})}}}]).controller("ModalInstanceCtrl",["$scope","$modalInstance","onCancel",function($scope,$modalInstance,onCancel){$scope.ok=$modalInstance.close,$scope.cancel=function(){onCancel&&onCancel(),$modalInstance.dismiss("cancel")}}]),angular.module("sc-dropdown",["sc-listing","ui.bootstrap.dropdown"]).constant("scDropdownDefaults",{btnClass:"btn btn-",btnDefault:"link",type:"simple",label:"Choose from the list"}).service("scDropdownApi",["$http",function($http){return{get:function(term,url){return $http({method:"GET",url:url+"&filter="+term})}}}]).directive("scDropdown",["$compile","scDropdownDefaults","scDropdownApi","$timeout",function($compile,defaults,Api,$timeout){return{restrict:"E",link:function($scope,element,attrs){function resetItems(){scope.items=original}function comparator(_item){return"multiple"!==flavor?angular.equals(_item,scope.selected.item):scope.selected.items.filter(function(item){return angular.equals(_item,item)}).length}var isDefined=angular.isDefined,isFunction=angular.isFunction,validTypes=["simple","single","split"],validFlavors=["single","multiple"],scope=$scope.$new();$scope.$on("$destroy",function(){scope.$destroy()});var labelTpl,flavor,search,searchUrl,dropdown={},autoSelect=!0,template="",startTag="",closeTag="",footer="",active="",searchTpl="",dropdownClass="dropdown-menu",btnClass=defaults.btnClass,btnDefault=defaults.btnDefault,type=defaults.type,label=defaults.label,original=$scope.$eval(attrs.items);scope.selected={},scope.items=$scope.$eval(attrs.items),$scope.$watch(attrs.items,function(items){scope.items=items}),$scope.$watch(attrs.ngModel,function(ngModel){scope.ngModel=ngModel}),scope.activeSelection=function(){return $scope.$eval(attrs.activeSelection)},scope.onToggle=function(){return $scope.$eval(attrs.onToggle)},scope.isOpen=$scope.$eval(attrs.isOpen);var attribute=$scope.$eval(attrs.attribute),keepLabel=isDefined(attrs.keepLabel);isDefined(attrs.autoSelect)&&(autoSelect=$scope.$eval(attrs.autoSelect)),isDefined(attrs.type)&&(type=$scope.$eval(attrs.type),type=~validTypes.indexOf(type)?type:"simple"),isDefined(attrs.search)&&attrs.search in{dynamic:1,"static":1}&&(search=attrs.search),"dynamic"===search&&isDefined(attrs.searchUrl)&&(searchUrl=$scope.$eval(attrs.searchUrl)),isDefined(attrs.label)&&attrs.$observe("label",function(val){scope.label=val}),isDefined(attrs.flavor)&&(flavor=$scope.$eval(attrs.flavor),~validFlavors.indexOf(flavor)||(flavor=void 0)),isDefined(attrs.default)&&(label=$scope.$eval(attrs.default),"multiple"===flavor?scope.selected.items=isFunction(label)?label():label:scope.selected.item=isFunction(label)?label():label,label=scope.selected.item),scope.label=scope.label||label,isDefined(attrs.btnClass)&&(btnDefault=$scope.$eval(attrs.btnClass)),btnClass+=btnDefault;var onSelect=$scope.$eval(attrs.onSelect);if("string"!=typeof scope.items[0]?(labelTpl="{{ selected.item['"+attribute+"'] || label }}",scope.template="<a href>{{ item['"+attribute+"'] }}</a>"):(labelTpl="{{ selected.item || label }}",scope.template="<a href>{{ item }}</a>"),keepLabel&&(labelTpl="{{ label }}"),"multiple"!==flavor||scope.selected.items||(scope.selected.items=[]),scope.select=function(item){if("multiple"!==flavor)return scope.selected.item=angular.equals(scope.selected.item,item)?void 0:item,void(autoSelect&&(onSelect(scope.selected.item),flavor&&scope.close()));var index=-1;scope.selected.items.forEach(function(_item,idx){angular.equals(_item,item)&&(index=idx)}),~index?scope.selected.items.splice(index,1):scope.selected.items.push(item),autoSelect&&onSelect(scope.selected.items)},search){var delay;scope.$watch("searchTerm",function(term){return term?term.length<=2?resetItems():"static"===search?void(scope.items=scope.items.filter(function(item){var str="string"==typeof item?item:item[attribute];console.log(str.match(term),str,term);var regex=new RegExp(term,"ig");return str.match(regex)})):($timeout.cancel(delay),void(delay=$timeout(function(){scope.searching=Api.get(term,searchUrl).then(function(res){scope.items=res.data,delete scope.searching}).catch(function(){delete scope.searching})},300))):resetItems()}),searchTpl=['<div class="sc-dropdown-search">','  <input type="text" ng-model="searchTerm" class="form-control" placeholder="Enter assignee name">',"</div>"].join("")}flavor&&(startTag=['<div class="sc-dropdown '+dropdownClass+'" ng-click="$event.stopPropagation()">','  <div class="sc-dropdown-header">','    <span ng-if="searching" class="loading"><i class="fa fa-spinner fa-spin"></i></span>',"    <strong>{{ label }}</strong>",'    <a href ng-click="close()" class="pull-right">','      <span aria-hidden="true">&times;</span>',"    </a>","  </div>","  "+searchTpl].join(""),scope.onSelect=onSelect,isDefined(attrs.footer)&&(footer=['  <div class="sc-dropdown-footer">','    <button class="btn btn-primary btn-xs btn-block" ng-click="onSelect(',"multiple"===flavor?"selected.items":"selected.item",')">',"      Apply","    </button>","  </div>"].join("")),closeTag=[footer,"</div>"].join(""),scope.active=function(_item){return comparator(_item)},scope.close=function(){scope.isOpen=!1,isDefined(attrs.isOpen)&&($scope.isOpen=!1)},active='active="active"',dropdownClass=""),isDefined(attrs.templateUrl)?template='template-url="'+attrs.templateUrl+'">':isDefined(attrs.template)?(scope.tpl=$scope.$eval(attrs.template),template='template="tpl">'):template='template="template">';var selectedClass;selectedClass=isDefined(attrs.activeSelection)?"ng-class=\"{ 'sc-dropdown-selected': activeSelection() }\"":"ng-class=\"{ 'sc-dropdown-selected': (selected.item || selected.items.length) }\"";var listing=[startTag,'  <sc-listing class="'+dropdownClass+'"',"    "+active,'    items="items"','    on-item-click="select"','    ng-model="ngModel"',"    "+template,"  </sc-listing>",closeTag].join("");dropdown.simple=['<span class="dropdown" dropdown is-open="isOpen" on-toggle="onToggle()(open)">','  <a href class="dropdown-toggle" dropdown-toggle '+selectedClass+">","    "+labelTpl,"  </a>","  "+listing,"</span>"].join(""),dropdown.single=['<div class="btn-group" dropdown is-open="isOpen" on-toggle="onToggle()(open)">','  <button type="button" class="'+btnClass+' dropdown-toggle" dropdown-toggle '+selectedClass+">","    "+labelTpl+' <span class="caret"></span>',"  </button>","  "+listing,"</div>"].join(""),dropdown.split=['<div class="btn-group" dropdown is-open="isOpen" on-toggle="onToggle()(open)">','  <button type="button" class="'+btnClass+'" dropdown-toggle '+selectedClass+">"+labelTpl+"</button>",'  <button type="button" class="'+btnClass+' dropdown-toggle">','    <span class="caret"></span>',"  </button>","  "+listing,"</div>"].join("");var html=isDefined(attrs.onlyListing)?listing:dropdown[type];element.replaceWith($compile(html)(scope))}}}]),angular.module("sc-enter",[]).directive("scEnter",function(){return function(scope,element,attrs){function enter(event){13===event.which&&(scope.$apply(function(){scope.$eval(attrs.scEnter,{event:event})}),event.preventDefault())}element.bind("keydown keypress",enter),scope.$on("$destroy",function(){element.unbind("keydown keypress",enter)})}}),angular.module("sc-list",[]).constant("scListDefaults",{limit:20,page:0,sort_type:1}).factory("scList",["scListDefaults",function(defaults){function List(Resource,options){if(!Resource||"Resource"!==constructorName(Resource))throw new Error("Resource must be an instance of $resource");if("function"!=typeof Resource.query)throw new Error("Resource must have a query function");options=options||{},this.options={},angular.extend(this.options,options),this.options.limit=options.limit||defaults.limit,this.options.page=options.page||defaults.page,this.options.sort_by=options.sort_by,this.options.sort_type=options.sort_type||defaults.sort_type,this.Resource=Resource}function constructorName(fn){return fn.toString().split("(")[0].split(/function\s*/)[1]}return List.prototype.sort=function(field,type){return this.options.sort_type=-1*parseInt(this.options.sort_type,10),this.fetch({sort_type:type*this.options.sort_type,sort_by:field})},List.prototype.goto=function(page){return this.options.page=parseInt(page,10),this.fetch()},List.prototype.more=function(){var pageNo=this.items&&this.items.length?this.options.page+1:this.options.page;return this.fetch({page:pageNo},!0)},List.prototype.refresh=List.prototype.fetch=function(options,append){var self=this;options=options||{},angular.extend(this.options,options);var items=this.Resource.query(this.options,function(res,headers){self.headers=headers()});return this.items||(this.items=[]),this.items.$promise=items.$promise,this.$promise=items.$promise,items.$promise.then(function(){append?self.items.push.apply(self.items,items):self.items=items}),items},List}]),angular.module("sc-listing",[]).directive("scListing",["$compile","$http","$q","$templateCache",function($compile,$http,$q,$templateCache){return{restrict:"E",link:function($scope,element,attrs){var template,templateUrl,scope=$scope.$new(),isDefined=angular.isDefined,deferred=$q.defer(),promise=deferred.promise,classes=["list sc-list"],itemClass=["list-item sc-list-item"];$scope.$on("$destroy",function(){scope.$destroy()}),isDefined(attrs.onItemClick)&&(scope.onItemClick=$scope.$eval(attrs.onItemClick)),isDefined(attrs.template)?(template=$scope.$eval(attrs.template),deferred.resolve(template)):isDefined(attrs.templateUrl)?(templateUrl=$scope.$eval(attrs.templateUrl),$http.get(templateUrl,{cache:$templateCache}).success(function(html){deferred.resolve(html)}).error(deferred.reject)):deferred.resolve(""),isDefined(attrs.class)&&classes.push(attrs.class),isDefined(attrs.itemClass)&&itemClass.push($scope.$eval(attrs.itemClass)),scope.active=isDefined(attrs.active)?$scope.$eval(attrs.active):angular.noop,$scope.$watch(attrs.items,function(items){scope.items=items}),$scope.$watch(attrs.ngModel,function(ngModel){scope.ngModel=ngModel}),classes=classes.join(" "),itemClass=itemClass.join(" "),promise.then(function(tpl){tpl=tpl||"{{ item | json }}";var template=['<ul class="'+classes+'">','  <li class="'+itemClass+'" ng-repeat="item in items track by $index" ng-click="onItemClick(item, $index)" ng-class="{ \'active\': active(item), \'last\': $last, \'first\': $first }" }">',"    "+tpl,"  </li>","</ul>"].join("");element.replaceWith($compile(template)(scope))})}}}]);//# sourceMappingURL=sc-components.js.map